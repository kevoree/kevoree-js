!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=14)}([function(e,t){e.exports=KevoreeLibrary},function(e,t){e.exports=function(e){if(e)for(var t=0;t<e.fragmentDictionary.array.length;t++){var n=e.fragmentDictionary.array[t],r=n.findValuesByID("isMaster");if(r&&"true"===r.value)return e.findSubNodesByID(n.name)}return null}},function(e,t,n){"use strict";function r(e){this.model=e}r.prototype={getModel:function(){return this.model},getType:function(){return"push"},toRaw:function(){return"push/"+this.model}},e.exports=r,e.exports.TYPE="push"},function(e,t,n){"use strict";function r(e){this.kevs=e}r.prototype={getKevScript:function(){return this.kevs},getType:function(){return"kevs"},toRaw:function(){return"kevs/"+this.kevs}},e.exports=r,e.exports.TYPE="kevs"},function(e,t,n){"use strict";function r(e,t){this.nodeName=e,this.model=t}var i="register";r.prototype={getNodeName:function(){return this.nodeName},getModel:function(){return this.model},getType:function(){return i},toRaw:function(){return i+"/"+this.nodeName+"/"+this.model}},e.exports=r,e.exports.TYPE=i},function(e,t,n){"use strict";function r(){}var i="registered";r.prototype={getType:function(){return i},toRaw:function(){return i}},e.exports=r,e.exports.TYPE=i},function(e,t){var n="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";e.exports=function(e){void 0===e&&(e=5);for(var t="",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,u,a,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var f=new Error('Uncaught, unspecified "error" event. ('+t+")");throw f.context=t,f}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),n.apply(this,u)}else if(o(n))for(u=Array.prototype.slice.call(arguments,1),c=n.slice(),i=c.length,a=0;a<i;a++)c[a].apply(this,u);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,s,u;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(u=s;u-- >0;)if(n[u]===t||n[u].listener&&n[u].listener===t){i=u;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){function n(){throw new Error("WebSocketServer are not supported in browser environment.")}WebSocket.prototype.on=function(e,t){this["on"+e]=t},WebSocket.prototype.off=function(e,t){"function"==typeof t&&this["on"+e]===t&&delete this["on"+e]},e.exports=WebSocket,e.exports.Server=n},function(e,t,n){function r(e){var t;if("object"==typeof e&&(e=e.data),e.startsWith(i.TYPE))return new i;if(e.startsWith(a.TYPE))return new a;if(e.startsWith(o.TYPE+"/"))return t=e.substring(o.TYPE.length+1),new o(t);if(e.startsWith(s.TYPE+"/"))return t=e.substring(s.TYPE.length+1),new s(t);if(e.startsWith(u.TYPE)){for(var n=e.substring(u.TYPE.length+1),r=0,c=n.charAt(r);r<n.length&&"/"!==c;)r++,c=n[r];var f=n.substring(0,r);return new u(f,n.substring(r+1))}return null}var i=n(10),o=n(2),s=n(3),u=n(4),a=n(5);e.exports={parse:r}},function(e,t,n){"use strict";function r(){}r.prototype={getType:function(){return"pull"},toRaw:function(){return"pull"}},e.exports=r,e.exports.TYPE="pull"},function(e,t){e.exports=function(e,t){return e&&"string"==typeof e?e.length>t?e.substr(0,t-3)+"...":e.substr(0,t):e}},function(e,t,n){function r(e,t,n){return!!e&&e.bindings.array.some(function(e){if(e.port&&e.port.eContainer()){var r=e.port.eContainer().eContainer();if(r.name===t||r.name===n)return!0}return!1})}function i(e,t,n){if(e){if(r(e.hub,t,n))return!0;if(e.port&&e.port.eContainer()){var o=e.port.eContainer().eContainer();if(o.name===t||o.name===n)return!0;e.port.bindings.array.some(function(r){return e.path()!==r.path()&&i(r,t,n)})}}}function o(e,t,n){return e.bindings.array.some(function(e){return!!i(e,t,n)})}function s(e,t,n){return!!e.provided.array.some(function(e){return!!o(e,t,n)})||e.required.array.some(function(e){return!!o(e,t,n)})}function u(e){return/^\/packages\[([\w]+)\]/.exec(e.typeDefinition.path())[1]}function a(e){var t=[];return t.push(u(e)),e.components.array.forEach(function(e){t.push(u(e))}),e.hosts.array.forEach(function(e){t.push(u(e))}),e.groups.array.forEach(function(e){t.push(u(e))}),t}function c(e,t,n){e.nodes.array.forEach(function(e){if(e.name!==t&&e.name!==n){e.components.array.some(function(e){return!!s(e,t,n)})||e.delete()}})}function f(e,t,n){e.mBindings.array.forEach(function(e){r(e.hub,t,n)||e.delete()})}function l(e,t,n){e.hubs.array.forEach(function(e){0===e.bindings.array.length?e.delete():r(e,t,n)||e.delete()})}function p(e,t,n){e.groups.array.forEach(function(e){var r=e.findSubNodesByID(t);r||(r=e.findSubNodesByID(n))||e.delete()})}function d(e,t,n){var r=[],i=e.findNodesByID(t),o=e.findNodesByID(n);i&&(r=r.concat(a(i))),o&&(r=r.concat(a(o))),r=m(r),e.packages.array.forEach(function(e){-1===r.indexOf(e.name)&&e.delete()})}function h(e,t,n){var r=new g.factory.DefaultKevoreeFactory,i=r.createModelCloner(),o=i.clone(e);return c(o,t,n),f(o,t,n),l(o,t,n),p(o,t,n),d(o,t,n),o}var g=n(0),m=n(22);e.exports=h},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function o(e){if(l===clearTimeout)return clearTimeout(e);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function s(){g&&d&&(g=!1,d.length?h=d.concat(h):m=-1,h.length&&u())}function u(){if(!g){var e=i(s);g=!0;for(var t=h.length;t;){for(d=h,h=[];++m<t;)d&&d[m].run();m=-1,t=h.length}d=null,g=!1,o(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var f,l,p=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(e){l=r}}();var d,h=[],g=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new a(e,t)),1!==h.length||g||i(u)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t,n){var r=n(15),i=n(16);KevoreeModuleLoader.register(r.name,r.version,i)},function(e,t){e.exports={name:"kevoree-group-centralizedws",version:"1.0.0-alpha.11",description:"WebSocket group based on a centralized architecture that only sends partial model to connected clients",main:"./lib/CentralizedWSGroup.js",scripts:{test:"mocha",prepublishOnly:"npm run lint && grunt publish",lint:"eslint lib test"},kevoree:{namespace:"kevoree"},browser:{ws:"./ws-shim.js"},dependencies:{"kevoree-entities":"^9.0.0","kevoree-library":"^5.0.10",rwebsocket:"^1.0.1",ws:"^1.1.1"},optionalDependencies:{bufferutil:"^1.3.0","utf-8-validate":"^2.0.0"},devDependencies:{"csv-write-stream":"^2.0.0",eslint:"^3.12.2",grunt:"^1","grunt-eslint":"^19.0.0","grunt-kevoree":"^6.0.0-alpha","grunt-kevoree-genmodel":"^3.0.2","grunt-kevoree-registry":"^4.0.0-alpha","grunt-webpack":"^3.0.0","json-loader":"^0.5.4","load-grunt-tasks":"^3.5.2",mocha:"^3.2.0",webpack:"^3.0.0"},repository:{type:"git",url:"git+https://github.com/kevoree/kevoree-js-group-centralizedws.git"},keywords:["kevoree","ws","group","centralized","partial","model"],author:"Maxime Tricoire <max.tricoire@gmail.com>",license:"LGPL-3.0",bugs:{url:"https://github.com/kevoree/kevoree-js-group-centralizedws/issues"},homepage:"https://github.com/kevoree/kevoree-js-group-centralizedws#readme"}},function(e,t,n){function r(e,t){return{info:function(n){e.info("CentralizedWSGroup",t+" "+n)},debug:function(n){e.debug("CentralizedWSGroup",t+" "+n)},warn:function(n){e.warn("CentralizedWSGroup",t+" "+n)},error:function(n){e.error("CentralizedWSGroup",t+" "+n)}}}var i=n(17),o=n(21),s=n(33),u=i.extend({toString:"CentralizedWSGroup",tdef_version:2,dic_isMaster:{optional:!1,defaultValue:!1,fragmentDependant:!0},dic_masterNet:{optional:!1,defaultValue:"lo.ipv4",fragmentDependant:!0},dic_port:{optional:!1,defaultValue:9e3},dic_onDisconnect:{defaultValue:""},dic_reduceModel:{optional:!1,defaultValue:!0},start:function(e){var t=this.dictionary.getBoolean("isMaster",this.dic_isMaster.defaultValue),n=this.dictionary.getString("masterNet",this.dic_masterNet.defaultValue),i=this.dictionary.getNumber("port",this.dic_port.defaultValue),u=n.match(/^([a-z0-9A-Z]+)\.([a-z0-9A-Z]+)$/);if(u&&u.length>0){if(t)this.fragment=o.create(r(this.log,"["+this.name+"][master]"),i,this),e();else try{this.fragment=s.create(r(this.log,"["+this.name+"][client]"),i,this,u[1],u[2]),e()}catch(t){e(t)}var a=this;this.dictionary.on("port",function(){t&&this.fragment.broadcast(r(this.log,"["+this.name+"][master]"),this),this.stop(function(){a.start(function(){})})})}else e(new Error('"masterNet" param must comply with /^[a-z0-9A-Z]+\\.[a-z0-9A-Z]+$/'))},stop:function(e){this.fragment.close(this),e()}});e.exports=u},function(e,t,n){"use strict";var r=n(18),i=r.extend({toString:"AbstractGroup",updateModel:function(e){this.kCore.deploy(e)}});e.exports=i},function(e,t,n){"use strict";var r=n(19),i=n(20),o=r({toString:"KevoreeEntity",construct:function(e,t,n){this.kCore=e,this.nodeName=n,this.name=t.name,this.path=t.path(),this.started=!1,this.dictionary=new i(this),this.log=this.kCore.getLogger()},start:function(e){e()},stop:function(e){e()},update:function(e){e()},__start__:function(e){this.started=!0,this.start(e)},__stop__:function(e){this.started=!1,this.stop(e)},__update__:function(e){this.update(e)},setKevoreeCore:function(e){this.kCore=e},getKevoreeCore:function(){return this.kCore},getDictionary:function(){return this.dictionary},getName:function(){return this.name},getNodeName:function(){return this.nodeName},setName:function(e){this.name=e},setPath:function(e){this.path=e},getPath:function(){return this.path},setNodeName:function(e){this.nodeName=e},getModelEntity:function(){var e=this.kCore.getDeployModel();return e||(e=this.kCore.getCurrentModel()),e.findByPath(this.path)},getNetworkInfos:function(e){var t=this.kCore.getDeployModel();t||this.kCore.getCurrentModel();var n=t.findNodesByID(e);return n?n.networkInformation.iterator():null},isStarted:function(){return this.started},submitScript:function(e,t){this.getKevoreeCore().submitScript(e,t)}});o.DIC="dic_",e.exports=o},function(e,t){!function(t){function n(){var e,t,n,r,i;for(n=arguments,e=0,t=n.length;e<t;e++){r=n[e];for(i in r)this[i]=r[i]}return this}function r(e){return function(){return this[e].apply(this,arguments)}}function i(e,t){var i,o,s,u,a,c;e.properties=t,a={},i=e;do{if(i.properties)for(s in i.properties)c=a[s]||(a[s]=[]),c.unshift(i.properties[s]);i=i.superConstructor}while(i);u={};for(s in a)o=u[s]=n.apply({},a[s]),"string"==typeof o.set&&(o.set=r(o.set)),"string"==typeof o.get&&(o.get=r(o.get));e.properties=u}var o=function(){},s=/xyz/.test(function(){return"xyz"})?/\._super\b/:{test:function(){return!0}},u=function(e,t,n){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);return this._super=r,i}},a=function(e,t,n){var r=n[e];return function(){return this._super=r,t.apply(this,arguments)}},c=function(e,t){t=t||this.constructor&&this.constructor.prototype;for(var n in e){var r=e[n];if("construct"!==n&&"destruct"!==n){t&&"function"==typeof r&&"function"==typeof t[n]&&s.test(r)?this.hasOwnProperty(n)?this[n]=a(n,r,this):this[n]=u(n,r,t):this[n]=r}}},f=function(e){return e&&e.extend?e.extend.extend(e):f.extend(e)};f.prototype.mixin=c,f.extend=function e(t){function n(){if(this instanceof n==!1)throw new Error("Cannot create instance without new operator");var e=n.properties;e&&Object.defineProperties(this,e),this.construct.apply(this,arguments),this.init()}var r=this,s=this.prototype;n.superConstructor=r,n.extend=e;var u=n.prototype=Object.create(s);if(u.constructor=n,u.superPrototype=s,t){var a=t.properties;if(delete t.properties,c.call(u,t,s),Array.isArray(t.mixins))for(var f=0,l=t.mixins.length;f<l;f++)c.call(u,t.mixins[f],u);if(i(n,a),t.construct){var p=t.construct;s.construct?u.construct=function(){s.construct.apply(this,arguments),p.apply(this,arguments)}:u.construct=p}if(t.destruct){var d=t.destruct;s.destruct?u.destruct=function(){d.apply(this,arguments),s.destruct.apply(this,arguments)}:u.destruct=d}if("string"==typeof t.toString){var h=t.toString;u.toString=function(){return h}}}return"function"!=typeof u.construct&&(u.construct=o),"function"!=typeof u.init&&(u.init=o),n},void 0!==e&&e.exports?e.exports=f:"function"==typeof t.define?function(e){e(function(){return f})}(t.define):(t.PseudoClass=f,t.Class||(t.Class=f))}(this)},function(e,t,n){"use strict";function r(e){this.entity=e,this.emitter=new o,this.map={}}var i=n(0),o=n(7).EventEmitter;r.prototype={on:function(e,t){this.emitter.addListener(e,t.bind(this.entity))},off:function(e,t){this.emitter.removeListener(e,t)},getValue:function(e){return this.map[e]},getBoolean:function(e,t){var n=this.map[e];return"true"===n||"false"===n?"true"===n:(void 0===t&&(t=!1),t)},getString:function(e,t){var n=this.map[e];return"string"==typeof n?n:("string"!=typeof t&&(t=null),t)},getNumber:function(e,t){var n;return n=this.map[e]&&0===this.map[e].length?null:+this.map[e],isNaN(n)?"number"!=typeof t?null:t:n},setValue:function(e,t){var n=new i.factory.DefaultKevoreeFactory,r=this.entity.getModelEntity();r.dictionary||(r.dictionary=n.createDictionary()),t=r.dictionary.findValuesByID(e),t||(t=n.createDictionaryValue(),t.name=e,r.dictionary.addValues(t)),t.value=t,this.setEntry(e,t)},setEntry:function(e,t){var n=this.map[e];this.map[e]=t,this.entity.isStarted()&&this.emitter.emit(e,t,n)},setMap:function(e){var t;if(Object.keys(this.map).length>0)for(var n in e){var r=!1;for(t in this.map)if(n===t){var i=this.map[t];i!==e[t]&&(this.map[t]=e[t],this.emitter.emit(t,this.map[t],i)),r=!0}r||(this.map[n]=e[n])}else this.map=e},getMap:function(){return this.map},cloneMap:function(){var e={};for(var t in this.map)e[t]=this.map[t];return e},toString:function(){return"Dictionary"}},e.exports=r},function(e,t,n){function r(e){return e&&e.length>0?", status="+e:""}function i(e,t,n,r,i){var o=c.parse(r);if(o)if(n.id)switch(e.debug('received message from node "'+x[n.id]+'" (id='+n.id+",msg="+h(r,20)+")"),o.getType()){case p.TYPE:y(e,x,n,i);break;case d.TYPE:e.debug("submitting kevscript:"),e.debug(o.getKevScript()),i.submitScript(o.getKevScript(),function(){e.debug("script executed")});break;default:e.warn('protocol message type "'+o.getType()+'" send by registered node (ignored)')}else switch(e.debug("received message from unknown client (msg="+h(r,20)+")"),o.getType()){case p.TYPE:y(e,x,n,i);break;case f.TYPE:v(e,x,n,o,i);break;case l.TYPE:b(e,t,x,n,o,i);break;default:e.warn('protocol message type "'+o.getType()+'" send by unknown client (ignored)')}else e.warn("unable to parse msg: "+h(r,20))}function o(e,t,n,i,o){if(t.id)e.info('node "'+x[t.id]+'" disconnected (id='+t.id+",code="+i+r(o)+")"),w(e,x,t,n,1e3===o);else{var s="unknown";t.upgradeReq.headers.origin&&(s=t.upgradeReq.headers.origin),e.debug('client "'+s+'" disconnected')}}function s(e,t,n,r){n.on("message",function(o){i(e,t,n,o,r)}),n.on("close",function(t,i){o(e,n,r,t,i)})}var u=n(8),a=n(0),c=n(9),f=n(4),l=n(2),p=n(10),d=n(3),h=n(11),g=n(12),m=n(1),v=n(23),y=n(29),b=n(30),w=n(31),x={};e.exports={client2name:x,create:function(e,t,n){var r=this;return r.server=new u.Server({port:t},function(){e.info("listening on 0.0.0.0:"+t)}),r.server.on("connection",function(t){s(e,r.server,t,n)}),this.deployHandler=function(){r.server.clients.length>0&&!n.isRegister?(e.debug("=== Broadcast new model to clients ==="),r.broadcast(e,n),e.debug("=== Broadcast done ===")):e.debug("Deployment is issued by a register (ignore broadcast)")},n.getKevoreeCore().on("deployed",this.deployHandler),this},broadcast:function(e,t){var n=new a.factory.DefaultKevoreeFactory,r=n.createJSONSerializer(),i=t.getKevoreeCore().getCurrentModel(),o=i,s=t.getModelEntity(),c=m(s).name,f=t.getDictionary().getBoolean("reduceModel",t.dic_reduceModel.defaultValue);this.server.clients.forEach(function(t){if(t.id){var n=x[t.id];f&&(o=g(i,c,n),e.debug(' âœ” reduced model for "'+n+'"'))}var s=r.serialize(o),a=new l(s).toRaw(),p="unknown";t.upgradeReq.headers.origin&&(p=t.upgradeReq.headers.origin),t.readyState===u.OPEN?(t.send(a),e.debug(' âœ” model pushed to "'+(x[t.id]?x[t.id]:p)+'"')):(e.debug(' âœ˜ unable to push to "'+(x[t.id]?x[t.id]:p)+'" (connection is closed)'),t.close())})},close:function(e){e.getKevoreeCore().off("deployed",this.deployHandler),this.server.close()}}},function(e,t){e.exports=function(e){for(var t={},n=[],r=0;r<e.length;r++)t[e[r]]=!0;for(var i in t)n.push(i);return n}},function(e,t,n){(function(t){var r=n(0),i=n(5),o=n(6),s=n(12),u=n(24),a=n(1);e.exports=function(e,n,c,f,l){if(n[c.id])e.warn('node "'+n[c.id]+'" is already registered (id='+c.id+")");else{c.id=o(10),n[c.id]=f.getNodeName(),e.info('node "'+f.getNodeName()+'" registered (id='+c.id+")");var p=new r.factory.DefaultKevoreeFactory,d=p.createJSONLoader(),h=p.createModelCloner(),g=null;try{g=d.loadModelFromString(f.getModel()).get(0)}catch(t){e.warn('erroneous model received from "'+f.getNodeName()+'" registration'),e.warn(t.stack)}if(g){var m=l.getModelEntity(),v=a(m).name;e.debug('reducing register model for master "'+v+'" and client "'+f.getNodeName()+'"...');var y=s(g,v,f.getNodeName()),b=p.createModelCompare(),w=l.getKevoreeCore(),x=h.clone(w.getCurrentModel());b.merge(y,x).applyOn(y),l.isRegister=!0,e.debug("isRegister lock = true"),w.deploy(y,function(){e.debug("isRegister lock = false"),l.isRegister=!1})}c.send((new i).toRaw());new u(c,t.env.KEV_CWSG_HB||15e3).start()}}}).call(t,n(13))},function(e,t,n){function r(e,t){var n=this;n.hbTimeout=t||a,n.client=e,e.on("pong",function(t){var r=t+"";r===n.pingMsg?(n.stop(),n.emit("pong",r),n.start()):(n.stop(),n.emit("pong-differs",r,n.pingMsg),e.close(4043,"pong answer differs from ping"))}),e.on("close",function(){n.emit("stop"),n.stop()})}var i=n(25),o=n(7),s=n(8),u=n(6),a=15e3;i.inherits(r,o.EventEmitter),r.prototype.start=function(){var e=this;e.heartBeatTimeout=setTimeout(function(){e.sendHeartBeat()},e.hbTimeout)},r.prototype.sendHeartBeat=function(){var e=this;this.client.readyState===s.OPEN?(this.pingMsg=u(),this.client.ping(this.pingMsg,null,!1),this.emit("ping",this.pingMsg),this.pingTimeout=setTimeout(function(){e.stop(),e.emit("pong-timeout",e.pingMsg),e.client.close(4042,"no pong answer")},5e3)):(e.stop(),e.emit("not-connected"))},r.prototype.stop=function(){clearTimeout(this.heartBeatTimeout),clearTimeout(this.pingTimeout)},e.exports=r},function(e,t,n){(function(e,r){function i(e,n){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(n)?r.showHidden=n:n&&t._extend(r,n),x(r.showHidden)&&(r.showHidden=!1),x(r.depth)&&(r.depth=2),x(r.colors)&&(r.colors=!1),x(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),a(r,e,r.depth)}function o(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function s(e,t){return e}function u(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function a(e,n,r){if(e.customInspect&&n&&k(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return b(i)||(i=a(e,i,r)),i}var o=c(e,n);if(o)return o;var s=Object.keys(n),g=u(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),T(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return f(n);if(0===s.length){if(k(n)){var m=n.name?": "+n.name:"";return e.stylize("[Function"+m+"]","special")}if(_(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(S(n))return e.stylize(Date.prototype.toString.call(n),"date");if(T(n))return f(n)}var v="",y=!1,w=["{","}"];if(h(n)&&(y=!0,w=["[","]"]),k(n)){v=" [Function"+(n.name?": "+n.name:"")+"]"}if(_(n)&&(v=" "+RegExp.prototype.toString.call(n)),S(n)&&(v=" "+Date.prototype.toUTCString.call(n)),T(n)&&(v=" "+f(n)),0===s.length&&(!y||0==n.length))return w[0]+v+w[1];if(r<0)return _(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special");e.seen.push(n);var x;return x=y?l(e,n,r,g,s):s.map(function(t){return p(e,n,r,g,t,y)}),e.seen.pop(),d(x,v,w)}function c(e,t){if(x(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return y(t)?e.stylize(""+t,"number"):g(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,n,r,i){for(var o=[],s=0,u=t.length;s<u;++s)z(t,String(s))?o.push(p(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))}),o}function p(e,t,n,r,i,o){var s,u,c;if(c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),z(r,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=m(n)?a(e,c.value,null):a(e,c.value,n-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),x(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function d(e,t,n){var r=0;return e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function h(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function m(e){return null===e}function v(e){return null==e}function y(e){return"number"==typeof e}function b(e){return"string"==typeof e}function w(e){return"symbol"==typeof e}function x(e){return void 0===e}function _(e){return E(e)&&"[object RegExp]"===C(e)}function E(e){return"object"==typeof e&&null!==e}function S(e){return E(e)&&"[object Date]"===C(e)}function T(e){return E(e)&&("[object Error]"===C(e)||e instanceof Error)}function k(e){return"function"==typeof e}function N(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function C(e){return Object.prototype.toString.call(e)}function M(e){return e<10?"0"+e.toString(10):e.toString(10)}function D(){var e=new Date,t=[M(e.getHours()),M(e.getMinutes()),M(e.getSeconds())].join(":");return[e.getDate(),P[e.getMonth()],t].join(" ")}function z(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var O=/%[sdj%]/g;t.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(e).replace(O,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),u=r[n];n<o;u=r[++n])m(u)||!E(u)?s+=" "+u:s+=" "+i(u);return s},t.deprecate=function(n,i){function o(){if(!s){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),s=!0}return n.apply(this,arguments)}if(x(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var s=!1;return o};var L,j={};t.debuglog=function(e){if(x(L)&&(L=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!j[e])if(new RegExp("\\b"+e+"\\b","i").test(L)){var n=r.pid;j[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else j[e]=function(){};return j[e]},t.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=g,t.isNull=m,t.isNullOrUndefined=v,t.isNumber=y,t.isString=b,t.isSymbol=w,t.isUndefined=x,t.isRegExp=_,t.isObject=E,t.isDate=S,t.isError=T,t.isFunction=k,t.isPrimitive=N,t.isBuffer=n(27);var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){console.log("%s - %s",D(),t.format.apply(t,arguments))},t.inherits=n(28),t._extend=function(e,t){if(!t||!E(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(t,n(26),n(13))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){var r=n(0);e.exports=function(e,t,n,i){var o=t[n.id];o?e.info("pull requested: "+o):e.info("pull requested");var s=new r.factory.DefaultKevoreeFactory,u=s.createJSONSerializer(),a=u.serialize(i.getKevoreeCore().getCurrentModel());n.send(a)}},function(e,t,n){var r=n(0),i=n(6);e.exports=function(e,t,n,o,s,u){var a=n[o.id];if(a)e.info("push issued by: "+a);else{var c="anonymous";o.upgradeReq.headers.origin&&(c=o.upgradeReq.headers.origin),e.info("push issued by "+c)}var f=new r.factory.DefaultKevoreeFactory,l=f.createJSONLoader();try{var p=l.loadModelFromString(s.getModel()).get(0),d=i(10);p.generated_KMF_ID=d,t.modelId=d,u.getKevoreeCore().deploy(p)}catch(t){e.error("erroneous model received (push ignored)")}}},function(e,t,n){var r=n(32);e.exports=function(e,t,n,i,o){var s=t[n.id];if(s&&(delete t[n.id],delete n.id,!o)){var u=i.getDictionary().getString("onDisconnect",i.dic_onDisconnect.defaultValue).trim();if(u.length>0){u=r(u,i.getName(),s),e.debug("submitting onDisconnect KevScript:"),e.debug(u);try{i.getKevoreeCore().submitScript(u)}catch(t){e.warn("onDisconnect KevScript interpretation error: "+i.getName()),e.warn(t.stack)}}}}},function(e,t){e.exports=function(e,t,n){return e.replace(/{nodeName}/g,n).replace(/{groupName}/g,t)}},function(e,t,n){function r(e,t,n,r,i){var o="";o=443===t?"wss://":"ws://";var a=s(n.getModelEntity());if(a){var c=u(n.getModelEntity(),a);if(c[r]){if(c[r][i])return o+c[r][i]+":"+t;throw new Error('Unable to find network value named "'+i+'" for master node "'+a.name+'"')}throw new Error('Unable to find network "'+r+'" for master node "'+a.name+'"')}throw new Error('No master node found. Did you set one node "isMaster" to "true"?')}var i=n(34),o=n(11),s=n(1),u=n(36),a=n(37),c=n(38),f=n(9),l=n(2),p=n(5),d=n(3);e.exports={create:function(e,t,n,s,u){var h=this,g=r(e,t,n,s,u);return h.client=new i(g),h.client.onopen=function(){e.info("connected to "+g),a(e,h.client,n)},h.client.onmessage=function(t){"object"==typeof t&&(t=t.data);var r=f.parse(t);if(r)if(h.client.isRegistered)switch(r.getType()){case l.TYPE:c(e,r,n);break;case d.TYPE:e.debug("kevs push are not handled yet");break;default:e.warn("unknown message type: "+r.getType()+' (msg: "'+o(t,15)+'")')}else switch(r.getType()){case p.TYPE:h.client.isRegistered=!0;break;default:e.warn('ignoring message type "'+r.getType()+'" send by master (state: not yet registered)')}else e.warn("unable to parse message: "+o(t,20))},h.client.onclose=function(t){h.client.isRegistered=!1,1e3!==t.code||e.info("connection closed with "+g+" (code="+t.code+",reason="+t.status+")")},h.client.connect(),this},close:function(){this.client.close()}}},function(e,t,n){function r(e,t,n){this.url=e,this.protocols=t,this.retryInterval=n||3e3}var i=n(35);r.prototype={connect:function(){var e=this;this.client=new i(this.url,this.protocols),this.readyState=this.client.readyState,this.protocol=this.client.protocol,this.client.onopen=function(){clearTimeout(e.connectTimeout),e.connectTimeout=null,e.onopen()},this.client.onmessage=function(t){e.onmessage(t)},this.client.onclose=function(t){1e3===t.code?(e.onclose(t),e.onterminate()):(e.onclose(t),clearTimeout(e.connectTimeout),e.connectTimeout=setTimeout(function(){e.connect()},e.retryInterval))},this.client.onerror=function(t){e.onerror(t),"ECONNREFUSED"===t.code&&(clearTimeout(e.connectTimeout),e.connectTimeout=setTimeout(function(){e.connect()},e.retryInterval))}},close:function(e,t){this.client&&(1e3===e?(clearTimeout(this.connectTimeout),this.client.close(e,t)):this.client.close(e,t))},terminate:function(e,t){this.client&&(clearTimeout(this.connectTimeout),this.client.close(e||1e3,t))},send:function(e){this.client&&this.client.send(e)},onopen:function(){},onmessage:function(){},onclose:function(){},onerror:function(){},onterminate:function(){}},e.exports=r},function(e,t,n){"use strict";WebSocket.prototype.on=function(e,t){this["on"+e]=t},WebSocket.prototype.off=function(e,t){"function"==typeof t&&this["on"+e]===t&&delete this["on"+e]},e.exports=WebSocket,e.exports.Server=function(){throw new Error("WebSocketServer is not supported in browser environment.")}},function(e,t){e.exports=function(e,t){var n={};if(e){var r=e.findSubNodesByID(t.name);r&&r.networkInformation.array.forEach(function(e){n[e.name]={},e.values.array.forEach(function(t){n[e.name][t.name]=t.value})})}return n}},function(e,t,n){var r=n(0),i=n(4);e.exports=function(e,t,n){var o,s=new r.factory.DefaultKevoreeFactory,u=s.createJSONSerializer();try{o=u.serialize(n.getKevoreeCore().getCurrentModel())}catch(t){e.warn("unable to serialize register model")}if(o){var a=new i(n.getNodeName(),o);t.send(a.toRaw())}}},function(e,t,n){var r=n(0),i=n(1);e.exports=function(e,t,n){var o,s=new r.factory.DefaultKevoreeFactory,u=s.createJSONLoader();try{o=u.loadModelFromString(t.getModel()).get(0)}catch(t){e.warn('unable to parse model pushed from master "'+i(n.getModelEntity()).name+'"')}o&&n.getKevoreeCore().deploy(o)}}]);
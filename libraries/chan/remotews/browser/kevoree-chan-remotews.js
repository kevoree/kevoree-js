!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";WebSocket.prototype.on=function(t,e){this["on"+t]=e},WebSocket.prototype.off=function(t,e){"function"==typeof e&&this["on"+t]===e&&delete this["on"+t]},t.exports=WebSocket,t.exports.Server=function(){throw new Error("WebSocketServer is not supported in browser environment.")}},function(t,e,n){"use strict";var i=n(2),r=n(3),o=n(4);i.register(r.name,r.version,o)},function(t,e){t.exports=KevoreeModuleLoader},function(t,e){t.exports={name:"kevoree-chan-remotews",version:"5.3.3",main:"./lib/RemoteWSChan.js",description:"A Kevoree chan that uses an external remote WebSocket broadcast server to share messages",kevoree:{namespace:"kevoree"},browser:{ws:"./node_modules/rwebsocket/browser/ws-shim.js"},scripts:{prestart:"npm run build",pretest:"npm run build",prepublishOnly:"npm run test",start:"kevoree-scripts start",build:"kevoree-scripts build",test:"mocha test","kev:publish":"kevoree-scripts publish",postpublish:"npm run kev:publish"},dependencies:{"kevoree-entities":"^9.2.3",rwebsocket:"^1.1.0"},devDependencies:{eslint:"^4.3.0","eslint-config-kevoree":"^1.0.1","kevoree-scripts":"^1.0.6",mocha:"^3.4.2"},keywords:["kevoree-std-lib","kevoree","library","channel"],author:"Maxime Tricoire <max.tricoire@gmail.com>",license:"LGPL-3.0",repository:{type:"git",url:"https://github.com/kevoree/kevoree-js.git"},bugs:{url:"https://github.com/kevoree/kevoree-js/issues"},homepage:"https://github.com/kevoree/kevoree-js"}},function(t,e,n){"use strict";var i=n(5),r=n(0),o=n(11),s=i.extend({toString:"RemoteWSChan",tdef_version:1,dic_host:{optional:!1},dic_port:{optional:!0,defaultValue:80},dic_path:{optional:!0,defaultValue:"/"},dic_uuid:{optional:!1},construct:function(){this.uri=null,this.receivers={},this.dispatchers={}},start:function(t){var e=this,n=void 0;try{e.uri=e.processURI()}catch(t){n=t}n?t(n):(e.getLocalInputPorts().forEach(function(t){var n=e.uri+t.path,i=new o(n);e.receivers[t.path]=i,i.onopen=function(){e.log.debug(e.name+' listening on topic "'+n+'"')},i.onmessage=function(t){e.localDispatch(t.data)},i.onerror=function(t){e.log.warn(t)},i.onclose=function(t){1e3===t.code?e.log.debug(e.name+' closed connection with topic "'+n+'"'):e.log.warn(e.name+' lost connection with topic "'+n+'"')},i.connect()}),e.getRemoteInputPorts().forEach(function(t){var n=e.uri+t.path;e.dispatchers[t.path]=new o(n),e.dispatchers[t.path].connect()}),t())},stop:function(t){var e=this;this.uri=null,Object.keys(this.receivers).forEach(function(t){try{e.receivers[t].close(1e3)}catch(t){}delete e.receivers[t]}),Object.keys(this.dispatchers).forEach(function(t){try{e.dispatchers[t].close(1e3)}catch(t){}delete e.dispatchers[t]}),t()},update:function(t){var e=this;e.stop(function(n){n?t(n):e.start(t)})},onSend:function(t,e,n){var i=this;this.localDispatch(n),this.getRemoteInputPorts().forEach(function(t){var e=i.dispatchers[t.path];e?e.client.readyState===r.OPEN?e.send(n+""):i.log.warn('"'+i.name+'" unable to dispatch "'+n+'" to topic"'+i.processURI()+t.path+'" (client not opened)'):i.log.warn('"'+i.name+'" unable to dispatch "'+n+'" to topic "'+i.processURI()+t.path+'" (client unavailable)')})},processURI:function(){var t=this.dictionary.getString("host"),e=this.dictionary.getNumber("port",s.prototype.dic_port.defaultValue),n=this.dictionary.getString("uuid"),i=this.dictionary.getString("path",s.prototype.dic_path.defaultValue);if(!t)throw new Error('"host" attribute is not specified');if(!n)throw new Error('"uuid" attribute is not specified');return null!==n.match(/\//g)?new Error('"uuid" attribute must not contain slashes ("/")'):("/"===i.substr(0,1)&&(i=i.substr(1,i.length)),i.length>0&&"/"===i.substr(i.length-1,1)&&(i=i.substr(0,i.length-2)),i.length>0?"ws://"+t+":"+e+"/"+i+"/"+n:"ws://"+t+":"+e+"/"+n)}});t.exports=s},function(t,e,n){"use strict";function i(t){return t&&t.length>15&&(t=t.substr(0,15)+"..."),t}var r=n(6),o=r.extend({toString:"AbstractChannel",construct:function(){this.inputs={},this.pendings=[]},__start__:function(t){var e=this;this._super(function(){e.pendings.forEach(function(t){e.internalSend(t.outputPath,t.content,t.callback)}),e.pendings.length=0,t()})},internalSend:function(t,e,n){var r=[],o=[],s=this.getKevoreeCore().getCurrentModel();s&&Object.keys(this.inputs).forEach(function(t){var e=s.findByPath(t);if(e){var n=e.eContainer();n&&n.started&&(r.push(t),o.push(n.eContainer().name+"."+n.name+"."+e.name))}}),this.started?(this.log.debug("-> "+i(e)+" -> ["+o.join(", ")+"]"),this.onSend(t,r,e+"",n)):(this.log.debug("-> "+i(e)+" -> ["+o.join(", ")+"] (queued)"),this.pendings.push({outputPath:t,content:e,callback:n}))},onSend:function(){},localDispatch:function(t,e){e=e||function(){},this.getLocalInputPorts().forEach(function(n){n.call(t,e)})},getOutputs:function(){var t=this,e=[],n=this.getModelEntity();return n&&n.bindings.array.forEach(function(n){n.port&&"required"===n.port.getRefInParent()&&n.port.eContainer().eContainer().name===t.getNodeName()&&-1===e.indexOf(n.port.path())&&e.push(n.port.path())}),e},getInputs:function(){var t=[],e=this.getModelEntity();return e&&e.bindings.array.forEach(function(e){e.port&&"provided"===e.port.getRefInParent()&&-1===t.indexOf(e.port.path())&&t.push(e.port.path())}),t},getInputPorts:function(){var t=this;return Object.keys(this.inputs).map(function(e){return t.inputs[e]})},getLocalInputPorts:function(){return this.getInputPorts().filter(function(t){return!t.isRemote})},getRemoteInputPorts:function(){return this.getInputPorts().filter(function(t){return t.isRemote})},addInputPort:function(t){this.inputs[t.path]=t},removeInputPort:function(t){delete this.inputs[t.path]}});t.exports=o},function(t,e,n){"use strict";var i=n(7),r=n(8),o=i({toString:"KevoreeEntity",construct:function(t,e,n){this.kCore=t,this.nodeName=n,this.name=e.name,this.path=e.path(),this.started=!1,this.dictionary=new r(this),this.log=this.kCore.getLoggerFactory().create(e.typeDefinition.name,e.name)},start:function(t){t()},stop:function(t){t()},update:function(t){t()},__start__:function(t){this.started=!0,this.start(t)},__stop__:function(t){this.started=!1,this.stop(t)},__update__:function(t){this.update(t)},__destruct__:function(){this.kCore.getLoggerFactory().delete(this.log)},getKevoreeCore:function(){return this.kCore},getDictionary:function(){return this.dictionary},getName:function(){return this.name},getNodeName:function(){return this.nodeName},getPath:function(){return this.path},getModelEntity:function(){var t=this.kCore.getDeployModel();return t||(t=this.kCore.getCurrentModel()),t.findByPath(this.path)},getNetworkInfos:function(t){var e=this.kCore.getDeployModel();e||this.kCore.getCurrentModel();var n=e.findNodesByID(t);return n?n.networkInformation.iterator():null},isStarted:function(){return this.started},submitScript:function(t,e){this.getKevoreeCore().submitScript(t,e)}});o.DIC="dic_",t.exports=o},function(t,e,n){"use strict";!function(e){function n(){var t,e,n,i,r;for(n=arguments,t=0,e=n.length;t<e;t++){i=n[t];for(r in i)this[r]=i[r]}return this}function i(t){return function(){return this[t].apply(this,arguments)}}function r(t,e){var r,o,s,c,u,a;t.properties=e,u={},r=t;do{if(r.properties)for(s in r.properties)a=u[s]||(u[s]=[]),a.unshift(r.properties[s]);r=r.superConstructor}while(r);c={};for(s in u)o=c[s]=n.apply({},u[s]),"string"==typeof o.set&&(o.set=i(o.set)),"string"==typeof o.get&&(o.get=i(o.get));t.properties=c}var o=function(){},s=/xyz/.test(function(){return"xyz"})?/\._super\b/:{test:function(){return!0}},c=function(t,e,n){return function(){var i=this._super;this._super=n[t];var r=e.apply(this,arguments);return this._super=i,r}},u=function(t,e,n){var i=n[t];return function(){return this._super=i,e.apply(this,arguments)}},a=function(t,e){e=e||this.constructor&&this.constructor.prototype;for(var n in t){var i=t[n];if("construct"!==n&&"destruct"!==n){e&&"function"==typeof i&&"function"==typeof e[n]&&s.test(i)?this.hasOwnProperty(n)?this[n]=u(n,i,this):this[n]=c(n,i,e):this[n]=i}}},h=function t(e){return e&&e.extend?e.extend.extend(e):t.extend(e)};h.prototype.mixin=a,h.extend=function t(e){function n(){if(this instanceof n==!1)throw new Error("Cannot create instance without new operator");var t=n.properties;t&&Object.defineProperties(this,t),this.construct.apply(this,arguments),this.init()}var i=this,s=this.prototype;n.superConstructor=i,n.extend=t;var c=n.prototype=Object.create(s);if(c.constructor=n,c.superPrototype=s,e){var u=e.properties;if(delete e.properties,a.call(c,e,s),Array.isArray(e.mixins))for(var h=0,p=e.mixins.length;h<p;h++)a.call(c,e.mixins[h],c);if(r(n,u),e.construct){var f=e.construct;s.construct?c.construct=function(){s.construct.apply(this,arguments),f.apply(this,arguments)}:c.construct=f}if(e.destruct){var l=e.destruct;s.destruct?c.destruct=function(){l.apply(this,arguments),s.destruct.apply(this,arguments)}:c.destruct=l}if("string"==typeof e.toString){var d=e.toString;c.toString=function(){return d}}}return"function"!=typeof c.construct&&(c.construct=o),"function"!=typeof c.init&&(c.init=o),n},void 0!==t&&t.exports?t.exports=h:"function"==typeof e.define?function(t){t(function(){return h})}(e.define):(e.PseudoClass=h,e.Class||(e.Class=h))}(void 0)},function(t,e,n){"use strict";function i(t){this.entity=t,this.emitter=new o.EventEmitter,this.map={}}var r=n(9),o=n(10);i.prototype={on:function(t,e){this.emitter.addListener(t,e.bind(this.entity))},off:function(t,e){this.emitter.removeListener(t,e)},getValue:function(t){return this.map[t]},getBoolean:function(t,e){var n=this.map[t];return"true"===n||"false"===n?"true"===n:(void 0===e&&(e=!1),e)},getString:function(t,e){var n=this.map[t];return"string"==typeof n?n:("string"!=typeof e&&(e=null),e)},getNumber:function(t,e){var n=void 0;return n=this.map[t]&&0===this.map[t].length?null:+this.map[t],isNaN(n)?"number"!=typeof e?null:e:n},setValue:function(t,e){var n=new r.factory.DefaultKevoreeFactory,i=this.entity.getModelEntity();i.dictionary||(i.dictionary=n.createDictionary()),e=i.dictionary.findValuesByID(t),e||(e=n.createDictionaryValue(),e.name=t,i.dictionary.addValues(e)),e.value=e,this.setEntry(t,e)},setEntry:function(t,e){var n=this.map[t];this.map[t]=e,this.entity.isStarted()&&this.emitter.emit(t,e,n)},setMap:function(t){var e=void 0;if(Object.keys(this.map).length>0)for(var n in t){var i=!1;for(e in this.map)if(n===e){var r=this.map[e];r!==t[e]&&(this.map[e]=t[e],this.emitter.emit(e,this.map[e],r)),i=!0}i||(this.map[n]=t[n])}else this.map=t},getMap:function(){return this.map},cloneMap:function(){var t={};for(var e in this.map)t[e]=this.map[e];return t},toString:function(){return"Dictionary"}},t.exports=i},function(t,e){t.exports=KevoreeLibrary},function(t,e,n){"use strict";function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function o(t){return"number"==typeof t}function s(t){return"object"===(void 0===t?"undefined":u(t))&&null!==t}function c(t){return void 0===t}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,n,i,o,u,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(n=this._events[t],c(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(s(n))for(o=Array.prototype.slice.call(arguments,1),a=n.slice(),i=a.length,u=0;u<i;u++)a[u].apply(this,o);return!0},i.prototype.addListener=function(t,e){var n;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=c(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},i.prototype.removeListener=function(t,e){var n,i,o,c;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],o=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(c=o;c-- >0;)if(n[c]===e||n[c].listener&&n[c].listener===e){i=c;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){"use strict";function i(t,e,n){this.url=t,this.protocols=e,this.retryInterval=n||3e3}var r=n(0);i.prototype={connect:function(){var t=this;this.client=new r(this.url,this.protocols),this.readyState=this.client.readyState,this.protocol=this.client.protocol,this.client.onopen=function(){clearTimeout(t.connectTimeout),t.connectTimeout=null,t.onopen()},this.client.onmessage=function(e){t.onmessage(e)},this.client.onclose=function(e){1e3===e.code?(t.onclose(e),t.onterminate()):(t.onclose(e),clearTimeout(t.connectTimeout),t.connectTimeout=setTimeout(function(){t.connect()},t.retryInterval))},this.client.onerror=function(e){t.onerror(e),"ECONNREFUSED"===e.code&&(clearTimeout(t.connectTimeout),t.connectTimeout=setTimeout(function(){t.connect()},t.retryInterval))}},close:function(t,e){this.client&&(1e3===t?(clearTimeout(this.connectTimeout),this.client.close(t,e)):this.client.close(t,e))},terminate:function(t,e){this.client&&(clearTimeout(this.connectTimeout),this.client.close(t||1e3,e))},send:function(t){this.client&&this.client.send(t)},onopen:function(){},onmessage:function(){},onclose:function(){},onerror:function(){},onterminate:function(){}},t.exports=i}]);